# golang gc

* golang 内存分配

    mheap
    
        代表Go程序持有的所有堆空间，Go程序使用一个mheap的全局对象_mheap来管理堆内存。

    mcentral 
        
        为mcache提供切分好的mpans，多线程共享，有加锁机制

    mcache 
    
        用来存储当前线程的mpan，线程独享
    
    mspan  

        Go中内存管理的基本单元，用来存储object，是由一片连续的8KB的页组成的大块内存。注意，这里的页和操作系统本身的页并不是一回事，它一般是操作系统页大小的几倍。一句话概括：mspan是一个包含起始地址、mspan规格、页的数量等内容的双端链表。会被runtime定义为两种类型（包含引用的，不包含引用的）

    object  

        mspan中被分割的对象，用来存储runtime时的存储对象。
    
    bitmap
        
        用来标示arean中那些地址已经存在对象

    arean
        
        堆区域，按8kb每页分割，把一些页组合起来就是mspan

    总结

        Go的内存分配器在分配对象时，根据对象的大小，分成三类：小对象（小于等于16B）、一般对象（大于16B，小于等于32KB）、大对象（大于32KB）。

        大体上的分配流程：

        32KB 的对象，直接从mheap上分配；

        <=16B 的对象使用mcache的tiny分配器分配；
        (16B,32KB] 的对象，首先计算对象的规格大小，然后使用mcache中相应规格大小的mspan分配；
        如果mcache没有相应规格大小的mspan，则向mcentral申请
        如果mcentral没有相应规格大小的mspan，则向mheap申请
        如果mheap中也没有合适大小的mspan，则向操作系统申请

* 三色标记

        扫描的根结点在哪里？栈？stw发生发生在什么阶段，

        扫描入口是mspan链表？
        
    
    

